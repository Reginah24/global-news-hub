<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global News Hub</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Same light gray background as your screenshot */
        }
        
        /* Simple loader animation */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ensure images in cards don't break the layout */
        .news-card-img {
            aspect-ratio: 16 / 9;
            object-fit: cover;
        }
        
        /* Hover effect for cards */
        .news-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 md:p-8">
        <!-- Header Section - Exactly like your screenshot -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Global News Hub</h1>
            <p class="text-lg text-gray-600 mt-2">Your daily source for worldwide headlines</p>
        </header>

        <!-- Controls/Filters Section - Exactly like your screenshot -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <!-- Search Keyword Input - Takes 2/3 width -->
                <div class="md:col-span-2">
                    <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Search Keyword</label>
                    <input type="text" id="search-input" placeholder="e.g., tech, economy..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                
                <!-- Category Select - Takes 1/3 width -->
                <div>
                    <label for="category-select" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                    <select id="category-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="general">General</option>
                        <option value="world">World</option>
                        <option value="nation">Nation</option>
                        <option value="business">Business</option>
                        <option value="technology">Technology</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="sports">Sports</option>
                        <option value="science">Science</option>
                        <option value="health">Health</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Main Content: News Articles -->
        <main>
            <!-- Loader Element -->
            <div id="loader" class="loader hidden"></div>
            
            <!-- Enhanced Error Message Container -->
            <div id="error-message" class="hidden text-center bg-red-100 border border-red-400 text-red-700 p-6 rounded-lg shadow-md mb-8">
                <div class="flex items-center justify-center mb-4">
                    <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                    <h3 class="text-lg font-semibold">Oops! Something went wrong</h3>
                </div>
                <p id="error-text" class="mb-4"></p>
                <button id="retry-btn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                    üîÑ Try Again
                </button>
            </div>

            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-12">
                <div class="bg-white rounded-lg shadow-md p-8">
                    <div class="text-6xl mb-4">üì∞</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">No articles found</h3>
                    <p class="text-gray-600 mb-6" id="no-results-text">Try different keywords or filters</p>
                    <button id="show-all-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        üì∞ Show All News
                    </button>
                </div>
            </div>
            
            <!-- News Articles Container - Exactly like your screenshot -->
            <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- News cards will be inserted here by JavaScript -->
            </div>
        </main>
    </div>

    <script>
        // Configuration
        const NEWS_API_KEY = document.querySelector('meta[name="news-api-key"]')?.content || 
                             window.NEWS_API_KEY || 
                             '6e7e3e191a044942bdfe97a0b382cf4d';
        
        // Check if API key is set
        if (NEWS_API_KEY === 'YOUR_API_KEY_HERE' || !NEWS_API_KEY) {
            console.error('NEWS_API_KEY not configured.');
            showError('API key not configured. Please contact the administrator.');
            return;
        }
        
        // Get DOM elements
        const searchInput = document.getElementById('search-input');
        const categorySelect = document.getElementById('category-select');
        const newsContainer = document.getElementById('news-container');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const noResults = document.getElementById('no-results');
        const noResultsText = document.getElementById('no-results-text');
        const retryBtn = document.getElementById('retry-btn');
        const showAllBtn = document.getElementById('show-all-btn');

        // Utility functions
        function hideAllMessages() {
            loader.classList.add('hidden');
            errorMessage.classList.add('hidden');
            noResults.classList.add('hidden');
        }

        function showLoader() {
            hideAllMessages();
            loader.classList.remove('hidden');
            newsContainer.innerHTML = '';
        }

        function showError(message) {
            hideAllMessages();
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function showNoResults(message) {
            hideAllMessages();
            noResultsText.textContent = message;
            noResults.classList.remove('hidden');
        }

        // Main news fetching function
        async function fetchNews() {
            showLoader();
            
            const query = searchInput.value.trim();
            const category = categorySelect.value;
            const country = 'us';

            // Build News API URL
            let newsApiUrl;
            if (query) {
                newsApiUrl = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&apiKey=${NEWS_API_KEY}&language=en&sortBy=publishedAt&pageSize=20`;
            } else {
                newsApiUrl = `https://newsapi.org/v2/top-headlines?apiKey=${NEWS_API_KEY}&language=en&country=${country}&pageSize=20`;
                if (category && category !== 'general') {
                    newsApiUrl += `&category=${category}`;
                }
            }

            // Use CORS proxy for API access
            const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(newsApiUrl);

            try {
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`Network error: ${response.status} - ${response.statusText}`);
                }
                
                const proxyData = await response.json();
                const data = JSON.parse(proxyData.contents);
                
                if (data.status === 'error') {
                    throw new Error(data.message || 'News API returned an error');
                }
                
                if (data.articles && data.articles.length > 0) {
                    displayArticles(data.articles);
                } else {
                    const message = query 
                        ? `No results found for "${query}". Try different keywords.`
                        : 'No articles available for the selected filters.';
                    showNoResults(message);
                }
            } catch (error) {
                console.error("Failed to fetch news:", error);
                showError(`Failed to retrieve news: ${error.message}. Please check your internet connection and try again.`);
            }
        }

        function displayArticles(articles) {
            hideAllMessages();
            newsContainer.innerHTML = '';
            
            articles.forEach((article, index) => {
                // Skip articles with removed content
                if (article.title === '[Removed]' || !article.title) return;
                
                // Use a placeholder image if the article image is missing
                const imageUrl = article.urlToImage || 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=600&h=400&fit=crop&crop=entropy&auto=format';
                
                const publishedDate = new Date(article.publishedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                const articleCard = `
                    <div class="news-card bg-white rounded-lg shadow-md overflow-hidden">
                        <img src="${imageUrl}" alt="${article.title}" class="news-card-img w-full" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=600&h=400&fit=crop&crop=entropy&auto=format';">
                        <div class="p-4">
                            <h3 class="text-lg font-bold mb-2 text-gray-900 leading-tight">${article.title}</h3>
                            <p class="text-sm text-gray-600 mb-4 line-clamp-3">${article.description || 'No description available.'}</p>
                            <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
                                <span>Source: ${article.source.name}</span>
                                <span>${publishedDate}</span>
                            </div>
                            <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="inline-block w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-center">
                                Read Full Article
                            </a>
                        </div>
                    </div>
                `;
                
                newsContainer.innerHTML += articleCard;
            });
        }

        // Event listeners
        categorySelect.addEventListener('change', fetchNews);

        searchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                fetchNews();
            }
        });

        retryBtn.addEventListener('click', fetchNews);

        showAllBtn.addEventListener('click', () => {
            searchInput.value = '';
            categorySelect.value = 'general';
            fetchNews();
        });

        // Load news when page loads
        window.addEventListener('load', fetchNews);
    </script>
</body>
</html>